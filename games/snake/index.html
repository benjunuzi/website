<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classic Snake Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        /* General body styling */
        body {
            background-color: #0d1117; /* Dark background */
            color: #e6edf3;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            font-family: 'Inter', sans-serif;
            padding: 20px;
        }

        /* Use a pixelated font for the game title/score */
        .game-font {
            font-family: 'Press Start 2P', cursive;
        }

        .game-container {
            background-color: #161b22;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.5), 0 0 50px rgba(0, 255, 0, 0.2);
            max-width: 420px;
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* Canvas styling */
        #gameCanvas {
            border: 4px solid #00ff00; /* Neon border */
            border-radius: 8px;
            background-color: #21262d; /* Slightly lighter inner background */
            box-shadow: inset 0 0 10px rgba(0, 255, 0, 0.3);
        }

        /* Control buttons for mobile/touch */
        .control-button {
            background-color: #00ff00;
            color: #0d1117;
            padding: 15px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.1s ease;
            box-shadow: 0 4px 0 #00aa00;
            text-align: center;
        }

        .control-button:active {
            box-shadow: 0 1px 0 #00aa00;
            transform: translateY(3px);
        }

        /* Game Over Modal Styling */
        #gameOverModal {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: none; /* Controlled by JS */
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        .modal-content {
            background-color: #161b22;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            border: 3px solid #ff4500;
            box-shadow: 0 0 30px rgba(255, 69, 0, 0.7);
        }

        .restart-button {
            background-color: #ff4500;
            color: white;
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            transition: background-color 0.2s;
            box-shadow: 0 3px 0 #cc3700;
        }

        .restart-button:hover {
            background-color: #cc3700;
        }
    </style>
</head>
<body>

    <div class="game-container">
        <h1 class="text-3xl game-font text-center mb-4 text-green-400">SNAKE</h1>
        <div class="flex justify-between items-center mb-4 px-2">
            <span class="game-font text-sm text-green-300">Score: <span id="score">0</span></span>
            <button id="startGameButton" class="px-4 py-2 bg-yellow-500 hover:bg-yellow-600 text-gray-900 rounded-lg font-bold transition-colors">Start Game</button>
        </div>

        <!-- Game Canvas -->
        <canvas id="gameCanvas" width="400" height="400"></canvas>

        <!-- Controls for Mobile/Touch -->
        <div class="mt-4 hidden sm:block">
            <p class="text-center text-sm mb-2 text-gray-400">Use ARROW keys to play.</p>
        </div>
        <div id="touchControls" class="grid grid-cols-3 gap-2 mt-4 sm:hidden">
            <div></div>
            <button class="control-button" onclick="moveSnake('up')">UP</button>
            <div></div>

            <button class="control-button" onclick="moveSnake('left')">LEFT</button>
            <button class="control-button" onclick="moveSnake('down')">DOWN</button>
            <button class="control-button" onclick="moveSnake('right')">RIGHT</button>
        </div>
    </div>

    <!-- Game Over Modal -->
    <div id="gameOverModal">
        <div class="modal-content">
            <h2 class="text-4xl game-font text-red-500 mb-4">GAME OVER!</h2>
            <p class="text-xl game-font mb-4">Final Score: <span id="finalScore" class="text-yellow-400">0</span></p>
            <button class="restart-button game-font" onclick="restartGame()">RESTART</button>
        </div>
    </div>

    <script>
        // Global constants for the game board
        const CANVAS_SIZE = 400;
        const GRID_SIZE = 20;
        const TILE_SIZE = CANVAS_SIZE / GRID_SIZE;
        const INITIAL_SPEED = 150; // Milliseconds per frame

        // Game state variables
        let canvas, ctx;
        let snake, food, direction, score, gameRunning, gameLoopInterval;
        let lastDirection = null; // To prevent immediate reverse
        let currentSpeed = INITIAL_SPEED;

        document.addEventListener('DOMContentLoaded', () => {
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');
            document.getElementById('startGameButton').addEventListener('click', startGame);

            // FIX: Initialize the game here, after canvas and context (ctx) are guaranteed to be defined.
            initializeGame();
        });

        // --- Core Game Functions ---

        /**
         * Initializes the game state and starts the main loop.
         */
        function initializeGame() {
            // Initial snake position (center of the board)
            snake = [{ x: 10, y: 10 }];
            direction = 'right';
            lastDirection = 'right';
            score = 0;
            gameRunning = false;
            currentSpeed = INITIAL_SPEED;
            document.getElementById('score').textContent = score;

            generateFood();
            drawGame(); // Draw initial state
        }

        /**
         * Generates a new food block at a random position, ensuring it doesn't overlap with the snake.
         */
        function generateFood() {
            let newFood;
            let foodOnSnake;
            do {
                foodOnSnake = false;
                // Generate random coordinates within the grid
                newFood = {
                    x: Math.floor(Math.random() * GRID_SIZE),
                    y: Math.floor(Math.random() * GRID_SIZE)
                };
                // Check if the new food overlaps with any part of the snake
                for (let i = 0; i < snake.length; i++) {
                    if (snake[i].x === newFood.x && snake[i].y === newFood.y) {
                        foodOnSnake = true;
                        break;
                    }
                }
            } while (foodOnSnake); // Repeat if food landed on the snake

            food = newFood;
        }

        /**
         * The main game logic: moves the snake, checks collisions, and handles food consumption.
         */
        function updateGame() {
            if (!gameRunning) return;

            // 1. Calculate new head position
            const newHead = { x: snake[0].x, y: snake[0].y };

            switch (direction) {
                case 'up': newHead.y--; break;
                case 'down': newHead.y++; break;
                case 'left': newHead.x--; break;
                case 'right': newHead.x++; break;
            }

            // Update the last direction after the move is decided
            lastDirection = direction;

            // 2. Check for collisions
            if (
                // Wall collision
                newHead.x < 0 || newHead.x >= GRID_SIZE ||
                newHead.y < 0 || newHead.y >= GRID_SIZE ||
                // Self collision (check new head against existing body, excluding the tail since it's about to be removed)
                checkSelfCollision(newHead)
            ) {
                gameOver();
                return;
            }

            // 3. Move snake (add new head)
            snake.unshift(newHead);

            // 4. Check for food consumption
            if (newHead.x === food.x && newHead.y === food.y) {
                score++;
                document.getElementById('score').textContent = score;
                generateFood(); // Generate new food

                // Speed up the game slightly every 5 points (optional)
                if (score % 5 === 0 && currentSpeed > 50) {
                    currentSpeed -= 10;
                    // Reset the interval with the new speed
                    clearInterval(gameLoopInterval);
                    gameLoopInterval = setInterval(gameLoop, currentSpeed);
                }
            } else {
                // If no food consumed, remove the tail
                snake.pop();
            }
        }

        /**
         * Checks if the new head position overlaps with the snake's body.
         * @param {object} head - The new head coordinates.
         * @returns {boolean} True if collision occurs.
         */
        function checkSelfCollision(head) {
            for (let i = 1; i < snake.length; i++) {
                if (head.x === snake[i].x && head.y === snake[i].y) {
                    return true;
                }
            }
            return false;
        }

        /**
         * Draws all game elements onto the canvas.
         */
        function drawGame() {
            // Clear canvas
            ctx.clearRect(0, 0, CANVAS_SIZE, CANVAS_SIZE);

            // Draw Food (a red circle/square)
            ctx.fillStyle = '#ff4500'; // Orange-Red
            ctx.fillRect(food.x * TILE_SIZE, food.y * TILE_SIZE, TILE_SIZE, TILE_SIZE);

            // Draw Snake
            for (let i = 0; i < snake.length; i++) {
                // Head has a different color for visibility
                ctx.fillStyle = i === 0 ? '#00e600' : '#00b300'; // Lighter/Darker Green
                // Add a small border or spacing to differentiate tiles
                ctx.fillRect(
                    snake[i].x * TILE_SIZE,
                    snake[i].y * TILE_SIZE,
                    TILE_SIZE - 1, // Subtract 1 for a slight visual gap
                    TILE_SIZE - 1
                );
            }
        }

        /**
         * The loop function that runs the game.
         */
        function gameLoop() {
            updateGame();
            drawGame();
        }

        /**
         * Handles the game starting logic.
         */
        function startGame() {
            if (gameRunning) return;

            initializeGame();
            gameRunning = true;
            document.getElementById('startGameButton').textContent = 'Playing...';
            document.getElementById('startGameButton').disabled = true;

            // Start the periodic game loop
            gameLoopInterval = setInterval(gameLoop, currentSpeed);
        }

        /**
         * Handles the game ending logic.
         */
        function gameOver() {
            gameRunning = false;
            clearInterval(gameLoopInterval);

            // Show Game Over Modal
            document.getElementById('finalScore').textContent = score;
            document.getElementById('gameOverModal').style.display = 'flex';
        }

        /**
         * Handles restarting the game.
         */
        function restartGame() {
            document.getElementById('gameOverModal').style.display = 'none';
            document.getElementById('startGameButton').textContent = 'Start Game';
            document.getElementById('startGameButton').disabled = false;
            startGame();
        }

        // --- Input Handling ---

        /**
         * Changes the snake's direction based on keyboard input, preventing immediate reverse.
         */
        document.addEventListener('keydown', (e) => {
            if (!gameRunning) return;

            // Use switch for cleaner key handling
            switch (e.key) {
                case 'ArrowUp':
                    if (lastDirection !== 'down') direction = 'up';
                    break;
                case 'ArrowDown':
                    if (lastDirection !== 'up') direction = 'down';
                    break;
                case 'ArrowLeft':
                    if (lastDirection !== 'right') direction = 'left';
                    break;
                case 'ArrowRight':
                    if (lastDirection !== 'left') direction = 'right';
                    break;
            }
        });

        /**
         * Changes the snake's direction for touch controls.
         * @param {string} newDir - 'up', 'down', 'left', or 'right'.
         */
        function moveSnake(newDir) {
            if (!gameRunning) return;

            if (newDir === 'up' && lastDirection !== 'down') direction = 'up';
            else if (newDir === 'down' && lastDirection !== 'up') direction = 'down';
            else if (newDir === 'left' && lastDirection !== 'right') direction = 'left';
            else if (newDir === 'right' && lastDirection !== 'left') direction = 'right';
        }

        // Expose moveSnake to the global scope for the onclick attributes
        window.moveSnake = moveSnake;
        window.restartGame = restartGame;

    </script>
</body>
</html>